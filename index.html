<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Clicker</title>

<style>
    body {
        margin: 0;
        background: #111;
        color: #fff;
        font-family: Arial, sans-serif;
        overflow-x: hidden;
        text-align: center;
        user-select: none;
    }

    h1 {
        margin-top: 20px;
    }

    #coin {
        width: 180px;
        margin-top: 25px;
        transition: transform 0.05s ease;
    }

    /* единый стиль для картинок предметов и цен */
    .item img, .price img {
        width: 40px;
        height: 40px;
        margin-right: 8px;
    }

    #coinsDisplay {
        font-size: 22px;
        margin-top: 10px;
    }

    #items {
        margin-top: 25px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
    }

    .item {
        display: flex;
        align-items: center;
        background: #222;
        padding: 10px 14px;
        border-radius: 10px;
        width: 260px;
        justify-content: space-between;
        cursor: pointer;
        transition: background 0.2s;
    }

    .item:hover {
        background: #333;
    }

    .item .name {
        font-size: 16px;
        margin-bottom: 4px;
    }

    .price {
        font-size: 15px;
        display: flex;
        align-items: center;
    }

    /* плавающие монетки */
    .floating {
        position: fixed;
        font-size: 22px;
        pointer-events: none;
        animation: floatUp 0.8s ease-out forwards;
        color: gold;
        text-shadow: 0 0 5px #000;
    }

    @keyframes floatUp {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(-60px);
        }
    }
</style>

</head>
<body>

<h1>Кликер</h1>
<img id="coin" src="https://i.imgur.com/6Y3JfUw.png">
<div id="coinsDisplay">Монеты: 0</div>

<div id="items"></div>

<script type="module">

/* ===== Firebase ===== */

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, set, update, get } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAcv5AfJPjUA-RGfcAsUiQwvucSxkJX4F0",
    authDomain: "anti-shop-99f1d.firebaseapp.com",
    databaseURL: "https://anti-shop-99f1d-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "anti-shop-99f1d",
    storageBucket: "anti-shop-99f1d.firebasestorage.app",
    messagingSenderId: "347202416802",
    appId: "1:347202416802:web:2d2df1b819be9da180e7fb"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ===== Игровое состояние ===== */

const userId = "player1";

const state = {
    coins: 0,
    clickPower: 1,
    lastSavedCoins: 0
};

/* ===== Предметы ===== */
const ITEMS = [
    { id: "stick",        name: "Палка",        base: 20,   inc: 1 },
    { id: "stone",        name: "Камень",       base: 50,   inc: 2 },
    { id: "iron",         name: "Железо",       base: 150,  inc: 4 },
    { id: "gold",         name: "Золото",       base: 300,  inc: 6 },
    { id: "diamond",      name: "Алмаз",        base: 600,  inc: 10 },
    { id: "netherite",    name: "Незерит",      base: 1200, inc: 20 }
];

/* ===== Загрузка данных из Firebase ===== */

async function loadData() {
    const snapshot = await get(ref(db, "users/" + userId));

    if (!snapshot.exists()) {
        console.log("Пользователь новый, создаём запись...");
        saveData();
        return;
    }

    const data = snapshot.val();

    state.coins = data.coins ?? 0;
    state.clickPower = data.clickPower ?? 1;

    updateCoinsDisplay();
}

/* ===== Сохранение ===== */

function saveData() {
    update(ref(db, "users/" + userId), {
        coins: state.coins,
        clickPower: state.clickPower
    });
}

/* ===== UI ===== */

const coin = document.getElementById("coin");
const coinsDisplay = document.getElementById("coinsDisplay");
const itemsDiv = document.getElementById("items");

function updateCoinsDisplay() {
    coinsDisplay.textContent = "Монеты: " + state.coins;
}

/* ===== Анимация клика ===== */

function spawnFloatingCoin(amount, x, y) {
    const el = document.createElement("div");
    el.className = "floating";
    el.style.left = x + "px";
    el.style.top = y + "px";
    el.textContent = "+" + amount;

    document.body.appendChild(el);
    setTimeout(() => el.remove(), 800);
}

/* ===== Клик монеты ===== */

coin.addEventListener("click", (e) => {
    state.coins += state.clickPower;
    updateCoinsDisplay();

    const rect = coin.getBoundingClientRect();
    spawnFloatingCoin(
        state.clickPower,
        rect.left + rect.width / 2,
        rect.top + rect.height / 2
    );

    saveData();
});

/* ===== Отображение предметов ===== */

function createItemElement(item) {
    const el = document.createElement("div");
    el.className = "item";

    el.innerHTML = `
        <div>
            <div class="name">${item.name}</div>
            <div class="price">
                <img src="https://i.imgur.com/6Y3JfUw.png">
                <span id="price_${item.id}">${item.base}</span>
            </div>
        </div>
        <div>+${item.inc}</div>
    `;

    el.addEventListener("click", () => buyItem(item));

    return el;
}

function renderItems() {
    ITEMS.forEach(item => {
        itemsDiv.appendChild(createItemElement(item));
    });
}

/* ===== Покупка предмета ===== */

function buyItem(item) {
    const costSpan = document.getElementById("price_" + item.id);
    let price = parseInt(costSpan.textContent);

    if (state.coins < price) return;

    state.coins -= price;
    state.clickPower += item.inc;

    // Увеличение цены после покупки
    price = Math.round(price * 1.2);
    costSpan.textContent = price;

    updateCoinsDisplay();
    saveData();
}

/* ===== Старт ===== */

renderItems();
loadData();

</script>
</body>
</html>
